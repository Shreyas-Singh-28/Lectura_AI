<!DOCTYPE html>
<html>
<head>
    <title>Study Recommender</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="upload-section">
            <div class="drop-zone" id="dropZone">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">
                    <div class="main-text">Drag & Drop or Click to Upload</div>
                    <div class="sub-text">.txt files only</div>
                </div>
                <input type="file" id="fileInput" accept=".txt">
            </div>
            <div class="loader" id="loader"></div>
        </div>
        
        <div class="results-section" id="resultsSection"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const loader = document.getElementById('loader');
            const resultsSection = document.getElementById('resultsSection');

            dropZone.addEventListener('click', () => fileInput.click());
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    processFile(e.dataTransfer.files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    processFile(e.target.files[0]);
                }
            });

            async function processFile(file) {
                if (!file.name.endsWith('.txt')) {
                    showError('Please upload a .txt file');
                    return;
                }

                try {
                    showLoader();
                    clearResults();
                    
                    const formData = new FormData();
                    formData.append('file', file);

                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Upload failed');
                    }

                    const data = await response.json();
                    displayResults(data);
                } catch (error) {
                    showError(error.message);
                } finally {
                    hideLoader();
                }
            }

            function showLoader() {
                loader.style.display = 'block';
                resultsSection.style.opacity = '0.5';
            }

            function hideLoader() {
                loader.style.display = 'none';
                resultsSection.style.opacity = '1';
            }

            function clearResults() {
                resultsSection.innerHTML = '';
                resultsSection.style.opacity = '0';
            }

            function showError(message) {
                resultsSection.innerHTML = `
                    <div class="error">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <div class="error-text">${message}</div>
                    </div>
                `;
                resultsSection.style.opacity = '1';
            }

            function displayResults(data) {
                resultsSection.innerHTML = `
                    <div class="platform youtube">
                        <h2>üé• YouTube Recommendations</h2>
                        <div class="items" id="youtubeItems"></div>
                    </div>
                    <div class="platform wikipedia">
                        <h2>üìö Wikipedia Articles</h2>
                        <div class="items" id="wikipediaItems"></div>
                    </div>
                    <div class="platform khan">
                        <h2>üè´ Khan Academy</h2>
                        <div class="items" id="khanItems"></div>
                    </div>
                `;

                displayPlatformResults('youtube', data.youtube || []);
                displayPlatformResults('wikipedia', data.wikipedia || []);
                displayPlatformResults('khan', data.khan || []);
            }

            function displayPlatformResults(platform, items) {
                const container = document.getElementById(`${platform}Items`);
                if (!items.length) {
                    container.innerHTML = `<div class="no-results">No ${platform} recommendations found</div>`;
                    return;
                }

                items.forEach((item, index) => {
                    const element = document.createElement('a');
                    element.href = item.url;
                    element.target = "_blank";
                    element.className = 'recommendation-item';
                    element.innerHTML = `
                        <div class="title">${item.title}</div>
                        <div class="url">${item.url}</div>
                    `;
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    container.appendChild(element);

                    setTimeout(() => {
                        element.style.transition = 'all 0.4s ease-out';
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }
        });
    </script>
</body>
</html>
